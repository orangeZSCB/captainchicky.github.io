var pms_payment_buttons;var $pms_auto_renew_field;var $pms_checked_subscription;var $pms_checked_paygate;var $pms_gateways_not_available;var pms_payment_button_loading_placeholder_text;jQuery(function($){if(window.history.replaceState){currentURL=window.location.href;currentURL=pms_remove_query_arg('pmsscscd',currentURL);currentURL=pms_remove_query_arg('pmsscsmsg',currentURL);currentURL=pms_remove_query_arg('pms_gateway_payment_action',currentURL);currentURL=pms_remove_query_arg('pms_gateway_payment_id',currentURL);if(currentURL!=window.location.href)
window.history.replaceState(null,null,currentURL);}
function pms_remove_query_arg(key,sourceURL){var rtn=sourceURL.split("?")[0],param,params_arr=[],queryString=(sourceURL.indexOf("?")!==-1)?sourceURL.split("?")[1]:"";if(queryString!==""){params_arr=queryString.split("&");for(var i=params_arr.length-1;i>=0;i-=1){param=params_arr[i].split("=")[0];if(param===key){params_arr.splice(i,1);}}
rtn=rtn+"?"+params_arr.join("&");}
if(rtn.split("?")[1]==""){rtn=rtn.split("?")[0];}
return rtn;}
pms_payment_buttons='input[name=pms_register], ';pms_payment_buttons+='input[name=pms_new_subscription], ';pms_payment_buttons+='input[name=pms_upgrade_subscription], ';pms_payment_buttons+='input[name=pms_renew_subscription], ';pms_payment_buttons+='input[name=pms_confirm_retry_payment_subscription], ';pms_payment_buttons+='.wppb-register-user input[name=register]';var subscription_plan_selector='input[name=subscription_plans]';var paygate_selector='input.pms_pay_gate';var settings_recurring=$('input[name="pms_default_recurring"]').val();$pms_auto_renew_field=jQuery('.pms-subscription-plan-auto-renew');$pms_checked_subscription=jQuery(subscription_plan_selector+'[type=radio]').length>0?jQuery(subscription_plan_selector+'[type=radio]:checked'):jQuery(subscription_plan_selector+'[type=hidden]');$pms_checked_paygate=jQuery(paygate_selector+'[type=radio]').length>0?jQuery(paygate_selector+'[type=radio]:checked'):jQuery(paygate_selector+'[type=hidden]');$pms_gateways_not_available=jQuery('#pms-gateways-not-available');pms_payment_button_loading_placeholder_text=$('#pms-submit-button-loading-placeholder-text').text();jQuery(document).ready(function(){function handle_auto_renew_field_display(){if($pms_checked_subscription.data('recurring')==1&&$pms_checked_paygate.data('recurring')!='undefined')
$pms_auto_renew_field.show();else
$pms_auto_renew_field.hide();if($pms_checked_subscription.data('recurring')==0){if(settings_recurring==1)
$pms_auto_renew_field.show();}
if($pms_checked_subscription.data('recurring')==2||$pms_checked_subscription.data('recurring')==3){$pms_auto_renew_field.hide();}
if($pms_checked_subscription.data('duration')==0||$pms_checked_subscription.data('price')==0){$pms_auto_renew_field.hide();}}
function handle_payment_gateways_display(){$('#pms-paygates-wrapper').show();$(paygate_selector).removeAttr('disabled');$(paygate_selector).closest('label').show();if($pms_checked_subscription.data('trial')&&$pms_checked_subscription.data('trial')!=0){$(paygate_selector+':not([data-trial])').attr('disabled',true);$(paygate_selector+':not([data-trial])').closest('label').hide();}
if($pms_checked_subscription.data('sign_up_fee')&&$pms_checked_subscription.data('sign_up_fee')!=0){$(paygate_selector+':not([data-sign_up_fee])').attr('disabled',true);$(paygate_selector+':not([data-sign_up_fee])').closest('label').hide();}
if($pms_checked_subscription.data('recurring')==2){$(paygate_selector+':not([data-recurring])').attr('disabled',true);$(paygate_selector+':not([data-recurring])').closest('label').hide();}else if($pms_checked_subscription.data('recurring')==1){if($pms_auto_renew_field.find('input[type=checkbox]').is(':checked')){$(paygate_selector+':not([data-recurring])').attr('disabled',true);$(paygate_selector+':not([data-recurring])').closest('label').hide();}}else if(!$pms_checked_subscription.data('recurring')){if(settings_recurring==1){if($pms_auto_renew_field.find('input[type=checkbox]').is(':checked')){$(paygate_selector+':not([data-recurring])').attr('disabled',true);$(paygate_selector+':not([data-recurring])').closest('label').hide();}}else if(settings_recurring==2){$(paygate_selector+':not([data-recurring])').attr('disabled',true);$(paygate_selector+':not([data-recurring])').closest('label').hide();}}
if($(paygate_selector+':not([disabled]):checked').length==0)
$(paygate_selector+':not([disabled])').first().trigger('click');if($(paygate_selector).length>0){if($(paygate_selector+':not([disabled])').length==0){$pms_gateways_not_available.show();$('.pms-credit-card-information').hide();$('.pms-billing-details').hide();if($pms_checked_subscription.data('price')!=0){if($pms_checked_subscription.length!=0)
$(pms_payment_buttons).attr('disabled',true).addClass('pms-submit-disabled');}}else{$pms_gateways_not_available.hide();if($(paygate_selector+':not([disabled]):checked[data-type="credit_card"]').length>0){$('.pms-credit-card-information').show();$('.pms-billing-details').show();}
if($pms_checked_subscription.length!=0)
$(pms_payment_buttons).attr('disabled',false).removeClass('pms-submit-disabled');}}
if($pms_checked_subscription.data('price')==0&&(typeof $pms_checked_subscription.data('sign_up_fee')=='undefined'||$pms_checked_subscription.data('sign_up_fee')==0)){$('#pms-paygates-wrapper').hide();$(paygate_selector).attr('disabled',true);$(paygate_selector).closest('label').hide();$('.pms-credit-card-information').hide();$('.pms-billing-details').hide();}}
jQuery(document).on('click',paygate_selector,function(){if(jQuery(this).is(':checked'))
$pms_checked_paygate=jQuery(this);if($pms_checked_paygate.data('type')=='credit_card'){$('.pms-credit-card-information').show();$('.pms-billing-details').show();}else{$('.pms-credit-card-information').hide();$('.pms-billing-details').hide();}});jQuery(document).on('click',subscription_plan_selector+'[type=radio], '+subscription_plan_selector+'[type="hidden"]',function(){if(jQuery(this).is(':checked'))
$pms_checked_subscription=jQuery(this);handle_auto_renew_field_display();handle_payment_gateways_display();});jQuery(document).on('click',pms_payment_buttons,function(e){if($(this).hasClass('pms-submit-disabled'))
return false;$(this).data('original-value',$(this).val());if(pms_payment_button_loading_placeholder_text.length>0)
$(this).addClass('pms-submit-disabled').val(pms_payment_button_loading_placeholder_text);});$pms_auto_renew_field.click(function(){handle_auto_renew_field_display();handle_payment_gateways_display();});handle_auto_renew_field_display();handle_payment_gateways_display();$('#pms-paygates-inner').css('visibility','visible');if($('.wppb-subscription-plans').length!=0){$(document).on("wppbRemoveRequiredAttributeEvent",pmsHandleGatewaysDisplayRemove)
function pmsHandleGatewaysDisplayRemove(event){if($('#pms-paygates-wrapper').is(':hidden'))
return
var element=event.target
if(typeof $(element).attr('conditional-name')=='undefined'||$(element).attr('conditional-name')!='subscription_plans')
return
var visible_plans=false
$('.wppb-subscription-plans').each(function(index,item){if($(item).is(':visible'))
visible_plans=true})
if(visible_plans===false){$('#pms-paygates-wrapper').hide();$(paygate_selector).attr('disabled',true);$(paygate_selector).closest('label').hide();$('.pms-credit-card-information').hide();$('.pms-billing-details').hide();}}
function pmsHandleGatewaysDisplayAdd(event){var element=event.target
if(typeof $(element).attr('conditional-name')=='undefined'||$(element).attr('conditional-name')!='subscription_plans')
return
var visible_plans=false
$('.wppb-subscription-plans').each(function(index,item){if($(item).is(':visible'))
visible_plans=true})
if(visible_plans===true)
handle_payment_gateways_display()}}});$.pms_add_field_error=function(error,field_name){if(error==''||error=='undefined'||field_name==''||field_name=='undefined')
return false;$field=$('[name='+field_name+']');$field_wrapper=$field.closest('.pms-field');error='<p>'+error+'</p>';if($field_wrapper.find('.pms_field-errors-wrapper').length>0)
$field_wrapper.find('.pms_field-errors-wrapper').html(error);else
$field_wrapper.append('<div class="pms_field-errors-wrapper pms-is-js">'+error+'</div>');};$.pms_add_general_error=function(error){if(error==''||error=='undefined')
return false
var target=$('.pms-form')
target.prepend('<div class="pms_field-errors-wrapper pms-is-js"><p>'+error+'</p></div>')}
$.pms_add_subscription_plans_error=function(error){if(error==''||error=='undefined')
return false
$('<div class="pms_field-errors-wrapper pms-is-js"><p>'+error+'</p></div>').insertBefore('#pms-paygates-wrapper')}
$.pms_clean_field_errors=function(){$('.pms_field-errors-wrapper.pms-is-js').remove();};jQuery("#pms-delete-account").on("click",function(e){e.preventDefault();var pmsDeleteUser=prompt(pmsGdpr.delete_text);if(pmsDeleteUser==="DELETE"){window.location.replace(pmsGdpr.delete_url);}
else{alert(pmsGdpr.delete_error_text);}});});jQuery(function($){$(document).ready(function(){if($('.pms-subscription-plan input[type=radio][data-price="0"]').is(':checked')||$('.pms-subscription-plan input[type=hidden]').attr('data-price')=='0'||$('.pms-subscription-plan input[type=radio]').prop('checked')==false){$('.pms-email-confirmation-payment-message').hide();}
if($('.pms-subscription-plan input[type=radio]').length>0){var has_paid_subscription=false;$('.pms-subscription-plan input[type=radio]').each(function(){if($(this).data('price')!=0)
has_paid_subscription=true;});if(!has_paid_subscription)
$('.pms-email-confirmation-payment-message').hide();}
$('.pms-subscription-plan input[type=radio]').click(function(){if($('.pms-subscription-plan input[type=radio][data-price="0"]').is(':checked')){$('.pms-email-confirmation-payment-message').hide();}
else{$('.pms-email-confirmation-payment-message').show();}});$('.wppb-edit-user input[required]').on('invalid',function(e){pms_reset_submit_button($('.wppb-edit-user .wppb-subscription-plans input[type="submit"]').first())});});function pms_reset_submit_button(target){setTimeout(function(){target.attr('disabled',false).removeClass('pms-submit-disabled').val(target.data('original-value')).blur();},1);}});jQuery(function($){$(document).ready(function(){if(typeof PMS_States=='undefined'||!PMS_States)
return
pms_handle_billing_state_field_display()
$(document).on('change','#pms_billing_country',function(){pms_handle_billing_state_field_display()})
if(typeof PMS_ChosenStrings!=='undefined'&&$.fn.chosen!=undefined){$('#pms_billing_country').chosen(JSON.parse(PMS_ChosenStrings))
if($('#pms_billing_state option').length>0)
$('#pms_billing_state').chosen(JSON.parse(PMS_ChosenStrings))}});function pms_handle_billing_state_field_display(){var country=$('.pms-billing-details #pms_billing_country').val()
if(PMS_States[country]){if(typeof PMS_ChosenStrings!=='undefined'&&$.fn.chosen!=undefined)
$('.pms-billing-state__select').chosen('destroy')
$('.pms-billing-state__select option').remove()
$('.pms-billing-state__select').append('<option value=""></option>');for(var key in PMS_States[country]){if(PMS_States[country].hasOwnProperty(key))
$('.pms-billing-state__select').append('<option value="'+key+'">'+PMS_States[country][key]+'</option>');}
var prevValue=$('.pms-billing-state__input').val()
if(prevValue!='')
$('.pms-billing-state__select').val(prevValue)
$('.pms-billing-state__input').removeAttr('name').removeAttr('id').hide()
$('.pms-billing-state__select').attr('name','pms_billing_state').attr('id','pms_billing_state').show()
if(typeof PMS_ChosenStrings!=='undefined'&&$.fn.chosen!=undefined)
$('.pms-billing-state__select').chosen(JSON.parse(PMS_ChosenStrings))}else{if(typeof PMS_ChosenStrings!=='undefined'&&$.fn.chosen!=undefined)
$('.pms-billing-state__select').chosen('destroy')
$('.pms-billing-state__select').removeAttr('name').removeAttr('id').hide()
$('.pms-billing-state__input').attr('name','pms_billing_state').attr('id','pms_billing_state').show()}}});