function Boxy(n,t){this.boxy=jQuery(Boxy.WRAPPER);jQuery.data(this.boxy[0],"boxy",this);this.visible=!1;this.options=jQuery.extend({},Boxy.DEFAULTS,t||{});this.options.modal&&(this.options=jQuery.extend(this.options,{center:!0,draggable:!1}));this.options.actuator&&jQuery.data(this.options.actuator,"active.boxy",this);this.setContent(n||"<div><\/div>");this._setupTitleBar();this.boxy.css("display","none").appendTo(document.body);this.toTop();this.options.fixed&&(jQuery.browser.msie&&jQuery.browser.version<7?this.options.fixed=!1:this.boxy.addClass("fixed"));this.options.center&&Boxy._u(this.options.x,this.options.y)?this.center():this.moveTo(Boxy._u(this.options.x)?this.options.x:Boxy.DEFAULT_X,Boxy._u(this.options.y)?this.options.y:Boxy.DEFAULT_Y);this.options.show&&this.show()}jQuery.fn.boxy=function(n){return n=n||{},this.each(function(){var t=this.nodeName.toLowerCase(),i=this;t=="a"?jQuery(this).click(function(){var u=Boxy.linkedTo(this),i=this.getAttribute("href"),t=jQuery.extend({actuator:this,title:this.title},n),r,f;return u?u.show():i.indexOf("#")>=0?(r=jQuery(i.substr(i.indexOf("#"))),f=r.clone(!0),r.remove(),t.unloadOnHide=!1,new Boxy(f,t)):(t.cache||(t.unloadOnHide=!0),Boxy.load(this.href,t)),!1}):t=="form"&&jQuery(this).bind("submit.boxy",function(){return Boxy.confirm(n.message||"Please confirm:",function(){jQuery(i).unbind("submit.boxy").submit()}),!1})})};Boxy.EF=function(){};jQuery.extend(Boxy,{WRAPPER:"<table cellspacing='0' cellpadding='0' border='0' class='boxy-wrapper'><tr><td class='top-left'><\/td><td class='top'><\/td><td class='top-right'><\/td><\/tr><tr><td class='left'><\/td><td class='boxy-inner'><\/td><td class='right'><\/td><\/tr><tr><td class='bottom-left'><\/td><td class='bottom'><\/td><td class='bottom-right'><\/td><\/tr><\/table>",DEFAULTS:{title:null,closeable:!0,draggable:!0,clone:!1,actuator:null,center:!0,show:!0,modal:!1,fixed:!0,closeText:"[close]",unloadOnHide:!1,clickToFront:!1,behaviours:Boxy.EF,afterDrop:Boxy.EF,afterShow:Boxy.EF,afterHide:Boxy.EF,beforeUnload:Boxy.EF},DEFAULT_X:50,DEFAULT_Y:50,zIndex:1337,dragConfigured:!1,resizeConfigured:!1,dragging:null,load:function(n,t){t=t||{};var i={url:n,type:"GET",dataType:"html",cache:!1,success:function(n){n=jQuery(n);t.filter&&(n=jQuery(t.filter,n));new Boxy(n,t)}};jQuery.each(["type","cache"],function(){this in t&&(i[this]=t[this],delete t[this])});jQuery.ajax(i)},get:function(n){var t=jQuery(n).parents(".boxy-wrapper");return t.length?jQuery.data(t[0],"boxy"):null},linkedTo:function(n){return jQuery.data(n,"active.boxy")},alert:function(n,t,i){return Boxy.ask(n,["OK"],t,i)},confirm:function(n,t,i){return Boxy.ask(n,["OK","Cancel"],function(n){n=="OK"&&t()},i)},ask:function(n,t,i,r){var u,f,e;r=jQuery.extend({modal:!0,closeable:!1},r||{},{show:!0,unloadOnHide:!0});var h=jQuery("<div><\/div>").append(jQuery('<div class="question"><\/div>').html(n)),o={},s=[];if(t instanceof Array)for(u=0;u<t.length;u++)o[t[u]]=t[u],s.push(t[u]);else for(f in t)o[t[f]]=f,s.push(t[f]);e=jQuery('<form class="answers"><\/form>');e.html(jQuery.map(s,function(n){return"<input type='button' value='"+n+"' />"}).join(" "));jQuery("input[type=button]",e).click(function(){var n=this;Boxy.get(this).hide(function(){i&&i(o[n.value])})});h.append(e);new Boxy(h,r)},IPYesNoCancel:function(n,t){t=jQuery.extend({modal:!0,closeable:!1},t||{},{show:!0,unloadOnHide:!1});var i;return i=t.width?jQuery("<div style='width:"+t.width+"px;'><\/div>"):jQuery("<div><\/div>"),i=i.append('<div class="popupband"><\/div>').append(jQuery('<div class="question"><\/div>').html(n)),i.append(jQuery("#boxyYesNoCancel")),new Boxy(i,t)},IPYesNoCancelPopup:function(n,t){t=jQuery.extend({modal:!0,closeable:!1},t||{},{show:!0,unloadOnHide:!1});var i=jQuery("<div><\/div>").append('<div class="popupband"><\/div>').append(jQuery(n));return i.append(jQuery("#boxyYesNoCancel")),new Boxy(i,t)},IPConfirm:function(n,t){t=jQuery.extend({modal:!0,closeable:!1},t||{},{show:!0,unloadOnHide:!1});var i;return i=t.width?jQuery("<div style='width:"+t.width+"px;'><\/div>"):jQuery("<div><\/div>"),i=i.append('<div class="popupband"><\/div>').append(jQuery(n)),i.append(jQuery("#boxyConfirm")),new Boxy(i,t)},showDialog:function(n,t){var i,r;return t=jQuery.extend({modal:!0,closeable:!1},t||{},{show:!0,unloadOnHide:!1}),i="",i=typeof n!="undefined"&&typeof n.jquery!="undefined"?n.prepend('<div class="popupband"><\/div>'):jQuery("<div><\/div>").append('<div class="popupband"><\/div>').append(jQuery('<div class="question"><\/div>').html(n)),r=jQuery("#dialogButtons"),r&&i.append(r),new Boxy(i,t)},isModalVisible:function(){return jQuery(".boxy-modal-blackout").length>0},_u:function(){for(var n=0;n<arguments.length;n++)if(typeof arguments[n]!="undefined")return!1;return!0},_handleResize:function(){var n=jQuery(document);jQuery(".boxy-modal-blackout").css("display","none").css({width:n.width(),height:n.height()}).css("display","block")},_handleDrag:function(n){var t;(t=Boxy.dragging)&&t[0].boxy.css({left:n.pageX-t[1],top:n.pageY-t[2]})},_nextZ:function(){return Boxy.zIndex++},_viewport:function(){var n=document.documentElement,i=document.body,t=window;return jQuery.extend(jQuery.browser.msie?{left:i.scrollLeft||n.scrollLeft,top:i.scrollTop||n.scrollTop}:{left:t.pageXOffset,top:t.pageYOffset},Boxy._u(t.innerWidth)?!Boxy._u(n)&&!Boxy._u(n.clientWidth)&&n.clientWidth!=0?{width:n.clientWidth,height:n.clientHeight}:{width:i.clientWidth,height:i.clientHeight}:{width:t.innerWidth,height:t.innerHeight})}});Boxy.prototype={estimateSize:function(){this.boxy.css({visibility:"hidden",display:"block"});var n=this.getSize();return this.boxy.css("display","none").css("visibility","visible"),n},getSize:function(){return[this.boxy.width(),this.boxy.height()]},getContentSize:function(){var n=this.getContent();return[n.width(),n.height()]},getPosition:function(){var n=this.boxy[0];return[n.offsetLeft,n.offsetTop]},getCenter:function(){var n=this.getPosition(),t=this.getSize();return[Math.floor(n[0]+t[0]/2),Math.floor(n[1]+t[1]/2)]},getInner:function(){return jQuery(".boxy-inner",this.boxy)},getContent:function(){return jQuery(".boxy-content",this.boxy)},setContent:function(n){return n=jQuery(n).css({display:"block"}).addClass("boxy-content"),this.options.clone&&(n=n.clone(!0)),this.getContent().remove(),this.getInner().append(n),this._setupDefaultBehaviours(n),this.options.behaviours.call(this,n),this},moveTo:function(n,t){return this.moveToX(n).moveToY(t),this},moveToX:function(n){return typeof n=="number"?this.boxy.css({left:n}):this.centerX(),this},moveToY:function(n){return typeof n=="number"?this.boxy.css({top:n}):this.centerY(),this},centerAt:function(n,t){var i=this[this.visible?"getSize":"estimateSize"]();return typeof n=="number"&&this.moveToX(n-i[0]/2),typeof t=="number"&&this.moveToY(t-i[1]/2),this},centerAtX:function(n){return this.centerAt(n,null)},centerAtY:function(n){return this.centerAt(null,n)},center:function(n){var t=Boxy._viewport(),i=this.options.fixed?[0,0]:[t.left,t.top];return n&&n!="x"||this.centerAt(i[0]+t.width/2,null),n&&n!="y"||this.centerAt(null,i[1]+t.height/2),this},centerX:function(){return this.center("x")},centerY:function(){return this.center("y")},resize:function(n,t,i){if(this.visible){var r=this._getBoundsForResize(n,t);return this.boxy.css({left:r[0],top:r[1]}),this.getContent().css({width:r[2],height:r[3]}),i&&i(this),this}},tween:function(n,t,i){if(this.visible){var r=this._getBoundsForResize(n,t),u=this;return this.boxy.stop().animate({left:r[0],top:r[1]}),this.getContent().stop().animate({width:r[2],height:r[3]},function(){i&&i(u)}),this}},isVisible:function(){return this.visible},show:function(){if(!this.visible){if(this.options.modal){var n=this;Boxy.resizeConfigured||(Boxy.resizeConfigured=!0,jQuery(window).resize(function(){Boxy._handleResize()}));this.modalBlackout=jQuery('<div class="boxy-modal-blackout"><\/div>').css({zIndex:Boxy._nextZ(),opacity:.1,width:jQuery(document).width(),height:jQuery(document).height()}).appendTo(document.body);this.toTop();this.options.closeable&&jQuery(document.body).bind("keypress.boxy",function(t){var i=t.which||t.keyCode;i==27&&(n.hide(),jQuery(document.body).unbind("keypress.boxy"))})}return this.boxy.stop().css({opacity:1}).show(),this.visible=!0,this._fire("afterShow"),this}},hide:function(n){if(this.visible){var t=this;return this.options.modal&&(jQuery(document.body).unbind("keypress.boxy"),this.modalBlackout.animate({opacity:0},function(){jQuery(this).remove()})),this.boxy.stop().animate({opacity:0},300,function(){t.boxy.css({display:"none"});t.visible=!1;t._fire("afterHide");n&&n(t);t.options.unloadOnHide&&t.unload()}),this}},toggle:function(){return this[this.visible?"hide":"show"](),this},hideAndUnload:function(n){return this.options.unloadOnHide=!0,this.hide(n),this},unload:function(){this._fire("beforeUnload");this.boxy.remove();this.options.actuator&&jQuery.data(this.options.actuator,"active.boxy",!1)},toTop:function(){return this.boxy.css({zIndex:Boxy._nextZ()}),this},getTitle:function(){return jQuery("> .title-bar h2",this.getInner()).html()},setTitle:function(n){return jQuery("> .title-bar h2",this.getInner()).html(n),this},_getBoundsForResize:function(n,t){var i=this.getContentSize(),r=[n-i[0],t-i[1]],u=this.getPosition();return[Math.max(u[0]-r[0]/2,0),Math.max(u[1]-r[1]/2,0),n,t]},_setupTitleBar:function(){if(this.options.title){var t=this,n=jQuery("<div class='title-bar'><\/div>").html("<h2>"+this.options.title+"<\/h2>");this.options.closeable&&n.append(jQuery("<a href='#' class='close'><\/a>").html(this.options.closeText));this.options.draggable&&(n[0].onselectstart=function(){return!1},n[0].unselectable="on",n[0].style.MozUserSelect="none",Boxy.dragConfigured||(jQuery(document).mousemove(Boxy._handleDrag),Boxy.dragConfigured=!0),n.mousedown(function(n){t.toTop();Boxy.dragging=[t,n.pageX-t.boxy[0].offsetLeft,n.pageY-t.boxy[0].offsetTop];jQuery(this).addClass("dragging")}).mouseup(function(){jQuery(this).removeClass("dragging");Boxy.dragging=null;t._fire("afterDrop")}));this.getInner().prepend(n);this._setupDefaultBehaviours(n)}},_setupDefaultBehaviours:function(n){var t=this;this.options.clickToFront&&n.click(function(){t.toTop()});jQuery(".close",n).click(function(){return t.hide(),!1}).mousedown(function(n){n.stopPropagation()})},_fire:function(n){this.options[n].call(this)}}